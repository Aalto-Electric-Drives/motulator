
<!DOCTYPE html>


<html lang="en" data-content_root="" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Observer Design &#8212; motulator 0.3.1 documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=5b4479735964841361fd" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=5b4479735964841361fd" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=5b4479735964841361fd" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=5b4479735964841361fd" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/graphviz.css?v=eafc0fe6" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery.css?v=61a4c737" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-binder.css?v=f4aeca0c" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-dataframe.css?v=2082cf3c" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-rendered-html.css?v=1277b6f3" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=5b4479735964841361fd" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=5b4479735964841361fd" />
  <script src="../_static/vendor/fontawesome/6.1.2/js/all.min.js?digest=5b4479735964841361fd"></script>

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js?v=51b6c1cc"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=4825356b"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'control/observers';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Examples" href="../auto_examples/index.html" />
    <link rel="prev" title="Current Control" href="current_ctrl.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>

  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
  
    <p class="title logo__title">motulator 0.3.1 documentation</p>
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Getting Started</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../usage.html">Usage</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../autoapi/motulator/index.html">API Reference</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../autoapi/motulator/common/index.html">motulator.common</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-2"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../autoapi/motulator/common/control/index.html">motulator.common.control</a></li>
<li class="toctree-l3"><a class="reference internal" href="../autoapi/motulator/common/model/index.html">motulator.common.model</a></li>
<li class="toctree-l3"><a class="reference internal" href="../autoapi/motulator/common/utils/index.html">motulator.common.utils</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../autoapi/motulator/drive/index.html">motulator.drive</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-3"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3 has-children"><a class="reference internal" href="../autoapi/motulator/drive/control/index.html">motulator.drive.control</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-4"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../autoapi/motulator/drive/control/im/index.html">motulator.drive.control.im</a></li>
<li class="toctree-l4"><a class="reference internal" href="../autoapi/motulator/drive/control/sm/index.html">motulator.drive.control.sm</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../autoapi/motulator/drive/model/index.html">motulator.drive.model</a></li>
<li class="toctree-l3"><a class="reference internal" href="../autoapi/motulator/drive/utils/index.html">motulator.drive.utils</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">System Models</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../model/system.html">Drive System</a></li>
<li class="toctree-l1"><a class="reference internal" href="../model/machines.html">Electric Machines</a></li>
<li class="toctree-l1"><a class="reference internal" href="../model/mechanics.html">Mechanics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../model/converters.html">Converters</a></li>
<li class="toctree-l1"><a class="reference internal" href="../model/ac_filter.html">Output LC Filter</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Control Methods</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1 current active has-children"><a class="reference internal" href="design_notes.html">Design Notes</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-5"><i class="fa-solid fa-chevron-down"></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="speed_ctrl.html">Speed Control</a></li>
<li class="toctree-l2"><a class="reference internal" href="current_ctrl.html">Current Control</a></li>
<li class="toctree-l2 current active"><a class="current reference internal" href="#">Observers</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../auto_examples/index.html">Examples</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-6"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../auto_examples/vector/index.html">Current-Vector Control</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-7"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../auto_examples/vector/plot_vector_ctrl_pmsm_2kw.html">2.2-kW PMSM</a></li>
<li class="toctree-l3"><a class="reference internal" href="../auto_examples/vector/plot_vector_ctrl_pmsm_2kw_diode.html">2.2-kW PMSM, diode bridge</a></li>
<li class="toctree-l3"><a class="reference internal" href="../auto_examples/vector/plot_vector_ctrl_syrm_7kw.html">6.7-kW SyRM</a></li>
<li class="toctree-l3"><a class="reference internal" href="../auto_examples/vector/plot_vector_ctrl_im_2kw_tq_mode.html">2.2-kW induction motor, torque-control mode</a></li>
<li class="toctree-l3"><a class="reference internal" href="../auto_examples/vector/plot_vector_ctrl_pmsyrm_thor.html">5-kW PM-SyRM</a></li>
<li class="toctree-l3"><a class="reference internal" href="../auto_examples/vector/plot_vector_ctrl_im_2kw.html">2.2-kW induction motor, saturated</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../auto_examples/vhz/index.html">V/Hz Control</a><input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-8"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../auto_examples/vhz/plot_vhz_ctrl_im_2kw.html">2.2-kW induction motor, diode bridge</a></li>
<li class="toctree-l3"><a class="reference internal" href="../auto_examples/vhz/plot_vhz_ctrl_6step_im_2kw.html">2.2-kW induction motor, 6-step mode</a></li>
<li class="toctree-l3"><a class="reference internal" href="../auto_examples/vhz/plot_vhz_ctrl_im_2kw_lc.html">2.2-kW induction motor, LC filter</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../auto_examples/obs_vhz/index.html">Observer-Based V/Hz Control</a><input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-9"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../auto_examples/obs_vhz/plot_obs_vhz_ctrl_pmsm_2kw.html">2.2-kW PMSM</a></li>
<li class="toctree-l3"><a class="reference internal" href="../auto_examples/obs_vhz/plot_obs_vhz_ctrl_im_2kw.html">2.2-kW induction motor</a></li>
<li class="toctree-l3"><a class="reference internal" href="../auto_examples/obs_vhz/plot_obs_vhz_ctrl_syrm_7kw.html">6.7-kW SyRM, saturated</a></li>
<li class="toctree-l3"><a class="reference internal" href="../auto_examples/obs_vhz/plot_obs_vhz_ctrl_pmsm_2kw_two_mass.html">2.2-kW PMSM, 2-mass mechanics</a></li>
<li class="toctree-l3"><a class="reference internal" href="../auto_examples/obs_vhz/plot_obs_vhz_ctrl_pmsyrm_thor.html">5-kW PM-SyRM, flux maps from SyR-e</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../auto_examples/flux_vector/index.html">Flux-Vector Control</a><input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-10"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../auto_examples/flux_vector/plot_flux_vector_pmsm_2kw.html">2.2-kW PMSM</a></li>
<li class="toctree-l3"><a class="reference internal" href="../auto_examples/flux_vector/plot_flux_vector_syrm_7kw.html">6.7-kW SyRM, saturated, disturbance estimation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../auto_examples/flux_vector/plot_flux_vector_pmsyrm_5kw.html">5.5-kW PM-SyRM, saturated</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../auto_examples/signal_inj/index.html">Signal Injection</a><input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-11"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../auto_examples/signal_inj/plot_signal_inj_pmsm_2kw.html">2.2-kW PMSM</a></li>
<li class="toctree-l3"><a class="reference internal" href="../auto_examples/signal_inj/plot_signal_inj_syrm_7kw.html">6.7-kW SyRM</a></li>
</ul>
</li>
</ul>
</li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">


<a href="https://github.com/Aalto-Electric-Drives/motulator" target="_blank"
   class="btn btn-sm btn-source-repository-button"
   title="Source repository"
   data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>

</a>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/control/observers.rst" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.rst</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Observer Design</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#induction-machines">Induction Machines</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#machine-model">Machine Model</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#observer-structure">Observer Structure</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#general-coordinates">General Coordinates</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#estimated-flux-coordinates">Estimated Flux Coordinates</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#gain-selection">Gain Selection</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#sensored-case">Sensored Case</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#sensorless-case">Sensorless Case</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#synchronous-machines">Synchronous Machines</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#machine-model-in-general-coordinates">Machine Model in General Coordinates</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id13">Observer Structure</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id15">Gain Selection</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id16">Sensored Case</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id17">Sensorless Case</a></li>
</ul>
</li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section id="observer-design">
<h1>Observer Design<a class="headerlink" href="#observer-design" title="Permalink to this heading">#</a></h1>
<p>An observer is commonly used to estimate the state of an electrical machine. In motion-sensored drives, the state of interest is typically the flux linkage. In sensorless drives, the rotor speed estimate is needed as well. Furthermore, sensorless synchronous machine drives require estimation of the rotor position.</p>
<section id="induction-machines">
<h2>Induction Machines<a class="headerlink" href="#induction-machines" title="Permalink to this heading">#</a></h2>
<p>In the following, reduced-order observer designs for the induction machine are considered <a class="footnote-reference brackets" href="#ver1988" id="id1" role="doc-noteref"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></a>, <a class="footnote-reference brackets" href="#har2001" id="id2" role="doc-noteref"><span class="fn-bracket">[</span>2<span class="fn-bracket">]</span></a>, <a class="footnote-reference brackets" href="#hin2010" id="id3" role="doc-noteref"><span class="fn-bracket">[</span>3<span class="fn-bracket">]</span></a>. Both sensored and sensorless observer variants are available in the <a class="reference internal" href="../autoapi/motulator/drive/control/im/index.html#motulator.drive.control.im.Observer" title="motulator.drive.control.im.Observer"><code class="xref py py-class docutils literal notranslate"><span class="pre">motulator.drive.control.im.Observer</span></code></a> class. Similar design principles are applied to synchronous machines as well.</p>
<section id="machine-model">
<h3>Machine Model<a class="headerlink" href="#machine-model" title="Permalink to this heading">#</a></h3>
<p>The inverse-Γ model of an induction machine is considered (see <a class="reference internal" href="../model/machines.html"><span class="doc">Electric Machines</span></a>). In a coordinate system rotating at the angular speed <span class="math notranslate nohighlight">\(\omega_\mathrm{s}\)</span>, the rotor flux dynamics can be expressed using the stator and rotor quantities, respectively, as</p>
<div class="math notranslate nohighlight" id="equation-dpsir">
<span class="eqno">(1)<a class="headerlink" href="#equation-dpsir" title="Permalink to this equation">#</a></span>\[\begin{split}\frac{\mathrm{d} \boldsymbol{\psi}_\mathrm{R}}{\mathrm{d} t} + \mathrm{j}\omega_\mathrm{s}\boldsymbol{\psi}_\mathrm{R} &amp;= \boldsymbol{u}_\mathrm{s} - R_\mathrm{s}\boldsymbol{i}_\mathrm{s} - L_\sigma \frac{\mathrm{d} \boldsymbol{i}_\mathrm{s}}{\mathrm{d} t} - \mathrm{j} \omega_\mathrm{s}L_\sigma\boldsymbol{i}_\mathrm{s} \\
&amp;= R_\mathrm{R}\boldsymbol{i}_\mathrm{s} - \left(\alpha - \mathrm{j}\omega_\mathrm{m} \right)\boldsymbol{\psi}_\mathrm{R}\end{split}\]</div>
<p>where <span class="math notranslate nohighlight">\(\omega_\mathrm{m}\)</span> is the electrical rotor angular speed.</p>
</section>
<section id="observer-structure">
<h3>Observer Structure<a class="headerlink" href="#observer-structure" title="Permalink to this heading">#</a></h3>
<section id="general-coordinates">
<h4>General Coordinates<a class="headerlink" href="#general-coordinates" title="Permalink to this heading">#</a></h4>
<p>Based on <a class="reference internal" href="#equation-dpsir">(1)</a>, a reduced-order observer can be formulated in a coordinate system rotating at <span class="math notranslate nohighlight">\(\omega_\mathrm{s}\)</span>,</p>
<div class="math notranslate nohighlight" id="equation-dhatpsir">
<span class="eqno">(2)<a class="headerlink" href="#equation-dhatpsir" title="Permalink to this equation">#</a></span>\[\frac{\mathrm{d} \hat{\boldsymbol{\psi}}_\mathrm{R}}{\mathrm{d} t} + \mathrm{j}\omega_\mathrm{s}\hat{\boldsymbol{\psi}}_\mathrm{R} = \boldsymbol{v} + \boldsymbol{k}_1(\hat{\boldsymbol{v}} - \boldsymbol{v}) + \boldsymbol{k}_2(\hat{\boldsymbol{v}} - \boldsymbol{v})^*\]</div>
<p>where <span class="math notranslate nohighlight">\(\boldsymbol{k}_1\)</span> and <span class="math notranslate nohighlight">\(\boldsymbol{k}_2\)</span> are complex gains, the estimates are marked with the hat, and <span class="math notranslate nohighlight">\(^*\)</span> marks the complex conjugate. The back-emf estimates are</p>
<div class="math notranslate nohighlight" id="equation-hatv">
<span class="eqno">(3)<a class="headerlink" href="#equation-hatv" title="Permalink to this equation">#</a></span>\[\begin{split}\boldsymbol{v} &amp;= \boldsymbol{u}_\mathrm{s} - R_\mathrm{s}\boldsymbol{i}_\mathrm{s} - L_\sigma \frac{\mathrm{d} \boldsymbol{i}_\mathrm{s}}{\mathrm{d} t} - \mathrm{j} \omega_\mathrm{s}L_\sigma\boldsymbol{i}_\mathrm{s} \\
    \hat{\boldsymbol{v}} &amp;= R_\mathrm{R}\boldsymbol{i}_\mathrm{s} - \left(\alpha - \mathrm{j}\hat{\omega}_\mathrm{m} \right)\hat{\boldsymbol{\psi}}_\mathrm{R}\end{split}\]</div>
<p>In sensored drives, the rotor speed estimate is replaced with the measured speed,  <span class="math notranslate nohighlight">\(\hat{\omega}_\mathrm{m} = \omega_\mathrm{m}\)</span>. If needed, the estimates for the stator flux linkage and the electromagnetic torque, respectively, are</p>
<div class="math notranslate nohighlight" id="equation-taum">
<span class="eqno">(4)<a class="headerlink" href="#equation-taum" title="Permalink to this equation">#</a></span>\[\begin{split}\hat{\boldsymbol{\psi}}_\mathrm{s} &amp;= \hat{\boldsymbol{\psi}}_\mathrm{R} + L_\sigma \boldsymbol{i}_\mathrm{s} \\
\hat{\tau}_\mathrm{M} &amp;= \frac{3n_\mathrm{p}}{2}\mathrm{Im}\left\{\boldsymbol{i}_\mathrm{s} \hat{\boldsymbol{\psi}}_\mathrm{R}^* \right\}\end{split}\]</div>
<p>It is also worth noticing that the derivative of the stator current in <a class="reference internal" href="#equation-hatv">(3)</a> is integrated, i.e., the noise is not amplified.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Real-valued column vectors and the corresponding <span class="math notranslate nohighlight">\(2\times 2\)</span> gain matrix were used in <a class="footnote-reference brackets" href="#hin2010" id="id4" role="doc-noteref"><span class="fn-bracket">[</span>3<span class="fn-bracket">]</span></a>. The complex form in <a class="reference internal" href="#equation-dhatpsir">(2)</a> has the same degrees of freedom.</p>
</div>
</section>
<section id="estimated-flux-coordinates">
<h4>Estimated Flux Coordinates<a class="headerlink" href="#estimated-flux-coordinates" title="Permalink to this heading">#</a></h4>
<p>The flux estimate in stator coordinates can be expressed using the polar form, <span class="math notranslate nohighlight">\(\hat{\boldsymbol{\psi}}_\mathrm{R}^\mathrm{s} = \hat{\psi}_\mathrm{R}\mathrm{e}^{\mathrm{j}\hat{\vartheta}_\mathrm{s}}\)</span>, where <span class="math notranslate nohighlight">\(\hat{\psi}_\mathrm{R}\)</span> is the magnitude and <span class="math notranslate nohighlight">\(\hat{\vartheta}_\mathrm{s}\)</span> is the angle of the estimate. The observer is convenient to implement in estimated rotor flux coordinates, in which the rotor flux estimate is real, <span class="math notranslate nohighlight">\(\hat{\boldsymbol{\psi}}_\mathrm{R} = \hat{\psi}_\mathrm{R} + \mathrm{j}0\)</span> <a class="footnote-reference brackets" href="#har2001" id="id5" role="doc-noteref"><span class="fn-bracket">[</span>2<span class="fn-bracket">]</span></a>. Under these conditions, the angular speed of the coordinates system can be solved from <a class="reference internal" href="#equation-dhatpsir">(2)</a> as</p>
<div class="math notranslate nohighlight" id="equation-hatws">
<span class="eqno">(5)<a class="headerlink" href="#equation-hatws" title="Permalink to this equation">#</a></span>\[\frac{\mathrm{d}\hat{\vartheta}_\mathrm{s}}{\mathrm{d} t} = \omega_\mathrm{s}
= \frac{\mathrm{Im} \{ \boldsymbol{v}' + \boldsymbol{k}_1(\hat{\boldsymbol{v}} - \boldsymbol{v}') + \boldsymbol{k}_2(\hat{\boldsymbol{v}} - \boldsymbol{v}')^* \} }{\hat{\psi}_\mathrm{R} + L_\sigma \mathrm{Re}\{(1 - \boldsymbol{k}_1)\boldsymbol{i}_\mathrm{s} + \boldsymbol{k}_2 \boldsymbol{i}_\mathrm{s}^* \}}\]</div>
<p>where</p>
<div class="math notranslate nohighlight" id="equation-vp">
<span class="eqno">(6)<a class="headerlink" href="#equation-vp" title="Permalink to this equation">#</a></span>\[\boldsymbol{v}' = \boldsymbol{u}_\mathrm{s} - R_\mathrm{s}\boldsymbol{i}_\mathrm{s} - L_\sigma \frac{\mathrm{d} \boldsymbol{i}_\mathrm{s}}{\mathrm{d} t}\]</div>
<p>The flux magnitude dynamics are</p>
<div class="math notranslate nohighlight" id="equation-dhatpsir-abs">
<span class="eqno">(7)<a class="headerlink" href="#equation-dhatpsir-abs" title="Permalink to this equation">#</a></span>\[\frac{\mathrm{d} \hat{\psi}_\mathrm{R}}{\mathrm{d} t}
= \mathrm{Re}\{ \boldsymbol{v} + \boldsymbol{k}_1(\hat{\boldsymbol{v}} - \boldsymbol{v}) + \boldsymbol{k}_2(\hat{\boldsymbol{v}} - \boldsymbol{v})^* \}\]</div>
<p>Notice that the right-hand side of <a class="reference internal" href="#equation-hatws">(5)</a> is independent of <span class="math notranslate nohighlight">\(\omega_\mathrm{s}\)</span>. Futhermore, in these coordinates, the condition <a class="reference internal" href="#equation-inherently">(12)</a> for an inherently sensorless observer reduces to <span class="math notranslate nohighlight">\(\boldsymbol{k}_2 = \boldsymbol{k}_1\)</span>. This observer structure is implemented in the <a class="reference internal" href="../autoapi/motulator/drive/control/im/index.html#motulator.drive.control.im.Observer" title="motulator.drive.control.im.Observer"><code class="xref py py-class docutils literal notranslate"><span class="pre">motulator.drive.control.im.Observer</span></code></a>, where simple forward-Euler discretization is used.</p>
</section>
</section>
<section id="gain-selection">
<h3>Gain Selection<a class="headerlink" href="#gain-selection" title="Permalink to this heading">#</a></h3>
<p>The estimation-error dynamics are obtained by subtracting <a class="reference internal" href="#equation-dhatpsir">(2)</a> from <a class="reference internal" href="#equation-dpsir">(1)</a>. The resulting system can be linearized for analysis and gain selection purposes. Using the rotor speed as an example, the small-signal deviation about the operating point is <span class="math notranslate nohighlight">\(\Delta \omega_\mathrm{m} = \omega_\mathrm{m} - \omega_\mathrm{m0}\)</span>, where the subscript 0 refers to the operating point. Linearization of the estimation-error dynamics leads to <a class="footnote-reference brackets" href="#hin2010" id="id6" role="doc-noteref"><span class="fn-bracket">[</span>3<span class="fn-bracket">]</span></a></p>
<div class="math notranslate nohighlight" id="equation-dtildepsir">
<span class="eqno">(8)<a class="headerlink" href="#equation-dtildepsir" title="Permalink to this equation">#</a></span>\[\frac{\mathrm{d} \Delta\tilde{\boldsymbol{\psi}}_\mathrm{R}}{\mathrm{d} t} =  \boldsymbol{k}_1\Delta \tilde{\boldsymbol{v}} + \boldsymbol{k}_2\Delta \tilde{\boldsymbol{v}}^* - \mathrm{j}\omega_\mathrm{s0}\Delta\tilde{\boldsymbol{\psi}}_\mathrm{R}\]</div>
<p>where the estimation error of the rotor flux is <span class="math notranslate nohighlight">\(\Delta\tilde{\boldsymbol{\psi}}_\mathrm{R} = \Delta\boldsymbol{\psi}_\mathrm{R} - \Delta\hat{\boldsymbol{\psi}}_\mathrm{R}\)</span> and other estimation errors are marked similarly. Furthermore, the back-emf estimation error is</p>
<div class="math notranslate nohighlight" id="equation-dtildev">
<span class="eqno">(9)<a class="headerlink" href="#equation-dtildev" title="Permalink to this equation">#</a></span>\[\Delta\tilde{\boldsymbol{v}} = -\left(\alpha - \mathrm{j}\omega_\mathrm{m0} \right)\Delta\tilde{\boldsymbol{\psi}}_\mathrm{R} + \mathrm{j}\boldsymbol{\psi}_\mathrm{R0}\Delta\tilde{\omega}_\mathrm{m}\]</div>
<section id="sensored-case">
<h4>Sensored Case<a class="headerlink" href="#sensored-case" title="Permalink to this heading">#</a></h4>
<p>Here, <span class="math notranslate nohighlight">\(\boldsymbol{k}_2 = 0\)</span> and <span class="math notranslate nohighlight">\(\Delta\tilde{\omega}_\mathrm{m} = 0\)</span> are assumed, corresponding to the sensored reduced-order observer in <a class="footnote-reference brackets" href="#ver1988" id="id7" role="doc-noteref"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></a>. Under these assumptions, the estimation-error dynamics in <a class="reference internal" href="#equation-dtildepsir">(8)</a> reduce to</p>
<div class="math notranslate nohighlight" id="equation-dtildepsir-sensored">
<span class="eqno">(10)<a class="headerlink" href="#equation-dtildepsir-sensored" title="Permalink to this equation">#</a></span>\[\frac{\mathrm{d} \Delta\tilde{\boldsymbol{\psi}}_\mathrm{R}}{\mathrm{d} t} =  -\left[\boldsymbol{k}_1\left(\alpha - \mathrm{j}\omega_\mathrm{m0} \right) + \mathrm{j}\omega_\mathrm{s0}\right]\Delta\tilde{\boldsymbol{\psi}}_\mathrm{R}\]</div>
<p>It can be noticed that the closed-loop pole could be arbitrarily placed via the gain <span class="math notranslate nohighlight">\(\boldsymbol{k}_1\)</span>. Well-damped estimation-error dynamics can be obtained, e.g., by choosing</p>
<div class="math notranslate nohighlight" id="equation-k1-sensored">
<span class="eqno">(11)<a class="headerlink" href="#equation-k1-sensored" title="Permalink to this equation">#</a></span>\[\boldsymbol{k}_1 = 1 + \frac{g |\omega_\mathrm{m}|}{\alpha - \mathrm{j}\omega_\mathrm{m}}\]</div>
<p>where <span class="math notranslate nohighlight">\(g\)</span> is a unitless positive design parameter. The corresponding pole is located at <span class="math notranslate nohighlight">\(s = -\alpha - g |\omega_\mathrm{m0}| - \mathrm{j}\omega_\mathrm{r0}\)</span>, where <span class="math notranslate nohighlight">\(\omega_\mathrm{r0} = \omega_\mathrm{s0} - \omega_\mathrm{m0}\)</span> is the operating-point slip angular frequency.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>As a special case, <span class="math notranslate nohighlight">\(\boldsymbol{k}_1  = 0\)</span> yields the voltage model. As another special case, the current model is obtained choosing <span class="math notranslate nohighlight">\(\boldsymbol{k}_1 = 1\)</span>.</p>
</div>
</section>
<section id="sensorless-case">
<h4>Sensorless Case<a class="headerlink" href="#sensorless-case" title="Permalink to this heading">#</a></h4>
<p>For sensorless drives, choosing</p>
<div class="math notranslate nohighlight" id="equation-inherently">
<span class="eqno">(12)<a class="headerlink" href="#equation-inherently" title="Permalink to this equation">#</a></span>\[\boldsymbol{k}_2 = (\hat{\boldsymbol{\psi}}_\mathrm{R}/\hat{\boldsymbol{\psi}}_\mathrm{R}^*) \boldsymbol{k}_1\]</div>
<p>yields an inherently sensorless observer, i.e., the rotor speed estimate <span class="math notranslate nohighlight">\(\hat{\omega}_\mathrm{m}\)</span> cancels out from the observer equations <a class="footnote-reference brackets" href="#hin2010" id="id8" role="doc-noteref"><span class="fn-bracket">[</span>3<span class="fn-bracket">]</span></a>. Under this condition, the linearized estimation-error dynamics in <a class="reference internal" href="#equation-dtildepsir">(8)</a> become</p>
<div class="math notranslate nohighlight" id="equation-dtildepsir-sensorless">
<span class="eqno">(13)<a class="headerlink" href="#equation-dtildepsir-sensorless" title="Permalink to this equation">#</a></span>\[\begin{split}\frac{\mathrm{d}}{\mathrm{d} t} \begin{bmatrix} \Delta\tilde{\psi}_\mathrm{Rd} \\ \Delta\tilde{\psi}_\mathrm{Rq} \end{bmatrix} = \begin{bmatrix} -2k_\mathrm{d}\alpha &amp; -2k_\mathrm{d}\omega_\mathrm{m0} + \omega_\mathrm{s0} \\ -2k_\mathrm{q}\alpha - \omega_\mathrm{s0} &amp; -2k_\mathrm{q}\omega_\mathrm{m0}
 \end{bmatrix} \begin{bmatrix} \Delta\tilde{\psi}_\mathrm{Rd} \\ \Delta\tilde{\psi}_\mathrm{Rq} \end{bmatrix}\end{split}\]</div>
<p>where the gain components correspond to <span class="math notranslate nohighlight">\(\boldsymbol{k}_1 = k_\mathrm{d} + \mathrm{j}k_\mathrm{q}\)</span>. It can be seen that the dynamics of the rotor speed are decoupled from the flux-estimation error dynamics. The decay rate <span class="math notranslate nohighlight">\(\sigma\)</span> be assigned by choosing</p>
<div class="math notranslate nohighlight" id="equation-k1-sensorless">
<span class="eqno">(14)<a class="headerlink" href="#equation-k1-sensorless" title="Permalink to this equation">#</a></span>\[\boldsymbol{k}_1 = \frac{\sigma}{\alpha - \mathrm{j}\hat\omega_\mathrm{m}}\]</div>
<p>which results in the characteristic polynomial <span class="math notranslate nohighlight">\(D(s)=s^2 + 2\sigma s + \omega_\mathrm{s0}^2\)</span>. The decay rate can be selected as <span class="math notranslate nohighlight">\(\sigma = \alpha/2 + \zeta_\infty|\hat{\omega}_\mathrm{m}|\)</span>, where <span class="math notranslate nohighlight">\(\zeta_\infty\)</span> is the desired damping ratio at high speed. At zero stator frequency <span class="math notranslate nohighlight">\(\omega_\mathrm{s0} = 0\)</span>, the poles are located at <span class="math notranslate nohighlight">\(s = 0\)</span> and <span class="math notranslate nohighlight">\(s = -\alpha\)</span>, which allows stable magnetizing and starting the machine.</p>
<p class="rubric">References</p>
<aside class="footnote-list brackets">
<aside class="footnote brackets" id="ver1988" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></span>
<span class="backrefs">(<a role="doc-backlink" href="#id1">1</a>,<a role="doc-backlink" href="#id7">2</a>)</span>
<p>Verghese, Sanders, “Observers for flux estimation in induction machines,” IEEE Trans. Ind. Electron., 1988, <a class="reference external" href="https://doi.org/10.1109/41.3067">https://doi.org/10.1109/41.3067</a></p>
</aside>
<aside class="footnote brackets" id="har2001" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span>2<span class="fn-bracket">]</span></span>
<span class="backrefs">(<a role="doc-backlink" href="#id2">1</a>,<a role="doc-backlink" href="#id5">2</a>)</span>
<p>Harnefors, “Design and analysis of general rotor-flux-oriented vector control systems,” IEEE Trans. Ind. Electron., 2001, <a class="reference external" href="https://doi.org/10.1109/41.915417">https://doi.org/10.1109/41.915417</a></p>
</aside>
<aside class="footnote brackets" id="hin2010" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span>3<span class="fn-bracket">]</span></span>
<span class="backrefs">(<a role="doc-backlink" href="#id3">1</a>,<a role="doc-backlink" href="#id4">2</a>,<a role="doc-backlink" href="#id6">3</a>,<a role="doc-backlink" href="#id8">4</a>)</span>
<p>Hinkkanen, Harnefors, Luomi, “Reduced-order flux observers with stator-resistance adaptation for speed-sensorless induction motor drives,” IEEE Trans. Power Electron., 2010, <a class="reference external" href="https://doi.org/10.1109/TPEL.2009.2039650">https://doi.org/10.1109/TPEL.2009.2039650</a></p>
</aside>
</aside>
</section>
</section>
</section>
<section id="synchronous-machines">
<h2>Synchronous Machines<a class="headerlink" href="#synchronous-machines" title="Permalink to this heading">#</a></h2>
<p>In sensorless control of synchronous machine drives, the rotor position and speed estimates are needed <a class="footnote-reference brackets" href="#jon1989" id="id9" role="doc-noteref"><span class="fn-bracket">[</span>4<span class="fn-bracket">]</span></a>, <a class="footnote-reference brackets" href="#cap2001" id="id10" role="doc-noteref"><span class="fn-bracket">[</span>5<span class="fn-bracket">]</span></a>, <a class="footnote-reference brackets" href="#hin2018" id="id11" role="doc-noteref"><span class="fn-bracket">[</span>6<span class="fn-bracket">]</span></a>. As a side product, the stator flux linkage is also estimated. In the following, an observer design available in the <a class="reference internal" href="../autoapi/motulator/drive/control/sm/index.html#motulator.drive.control.sm.Observer" title="motulator.drive.control.sm.Observer"><code class="xref py py-class docutils literal notranslate"><span class="pre">motulator.drive.control.sm.Observer</span></code></a> class is considered, which is based on <a class="footnote-reference brackets" href="#hin2018" id="id12" role="doc-noteref"><span class="fn-bracket">[</span>6<span class="fn-bracket">]</span></a>. This observer implementation also includes a sensored mode.</p>
<section id="machine-model-in-general-coordinates">
<h3>Machine Model in General Coordinates<a class="headerlink" href="#machine-model-in-general-coordinates" title="Permalink to this heading">#</a></h3>
<p>In <a class="reference internal" href="../model/machines.html"><span class="doc">Electric Machines</span></a>, the synchronous machine model is given in rotor coordinates. For the observer design and analysis, it is convenient to express this model in general coordinates, aligned at <span class="math notranslate nohighlight">\(\vartheta_\mathrm{s}\)</span> and rotating at <span class="math notranslate nohighlight">\(\omega_\mathrm{s} = \mathrm{d} \vartheta_\mathrm{s}/\mathrm{d} t\)</span> with respect to stator coordinates. Furthermore, the rotor is aligned at <span class="math notranslate nohighlight">\(\vartheta_\mathrm{m}\)</span> and rotates at <span class="math notranslate nohighlight">\(\omega_\mathrm{m} = \mathrm{d} \vartheta_\mathrm{m}/\mathrm{d} t\)</span> with respect to stator coordinates. This coordinate transformation results in</p>
<div class="math notranslate nohighlight" id="equation-sm">
<span class="eqno">(15)<a class="headerlink" href="#equation-sm" title="Permalink to this equation">#</a></span>\[\begin{split}\frac{\mathrm{d}\boldsymbol{\psi}_\mathrm{s}}{\mathrm{d} t} &amp;= \boldsymbol{u}_\mathrm{s} - R_\mathrm{s}\boldsymbol{i}_\mathrm{s} - \mathrm{j}\omega_\mathrm{s}\boldsymbol{\psi}_\mathrm{s} \\
\frac{\mathrm{d}\delta}{\mathrm{d} t} &amp;= \omega_\mathrm{m} - \omega_\mathrm{s}\end{split}\]</div>
<p>where <span class="math notranslate nohighlight">\(\boldsymbol{u}_\mathrm{s}\)</span> is the stator voltage, <span class="math notranslate nohighlight">\(\boldsymbol{i}_\mathrm{s}\)</span> is the stator current, and <span class="math notranslate nohighlight">\(\delta = \vartheta_\mathrm{m} - \vartheta_\mathrm{s}\)</span> is the electrical angle of the rotor as seen from the general coordinate system. Assuming linear magnetics, the relation between the stator flux linkage and the stator current is governed by</p>
<div class="math notranslate nohighlight" id="equation-sm-flux-gen">
<span class="eqno">(16)<a class="headerlink" href="#equation-sm-flux-gen" title="Permalink to this equation">#</a></span>\[\boldsymbol{\psi}_\mathrm{s} = \mathrm{e}^{\mathrm{j}\delta}\left(L_\mathrm{d}\mathrm{Re}\{\boldsymbol{i}_\mathrm{s} \mathrm{e}^{-\mathrm{j}\delta}\} + \mathrm{j}L_\mathrm{q}\mathrm{Im}\{\boldsymbol{i}_\mathrm{s}\mathrm{e}^{-\mathrm{j}\delta}\} + \psi_\mathrm{f}\right)\]</div>
<p>where <span class="math notranslate nohighlight">\(L_\mathrm{d}\)</span> is the d-axis inductance, <span class="math notranslate nohighlight">\(L_\mathrm{q}\)</span> is the q-axis inductance, and <span class="math notranslate nohighlight">\(\psi_\mathrm{f}\)</span> is the PM flux linkage.</p>
<p>Notice that setting <span class="math notranslate nohighlight">\(\vartheta_\mathrm{s}=0\)</span> yields the machine model in stator coordinates. In the following, the coordinate system will be fixed to the estimated angle of the rotor, i.e., to the coordinate system used by the control system.</p>
</section>
<section id="id13">
<h3>Observer Structure<a class="headerlink" href="#id13" title="Permalink to this heading">#</a></h3>
<p>The observer is assumed to operate in estimated rotor coordinates, whose d-axis is aligned with the rotor angle estimate <span class="math notranslate nohighlight">\(\hat{\vartheta}_\mathrm{m}\)</span>. Now, the angle <span class="math notranslate nohighlight">\(\delta = \vartheta_\mathrm{m} - \hat{\vartheta}_\mathrm{m}\)</span> in the machine model <a class="reference internal" href="#equation-sm">(15)</a> corresponds to the estimation error of the rotor angle, which naturally is unknown to the sensorless control system.</p>
<p>Since the stator current is measured, the observer is fundamentally corrected by means of the current estimation error. However, due to the saliency, it is more convenient to scale the current estimation error by the stator inductance, resulting in the flux linkage error</p>
<div class="math notranslate nohighlight" id="equation-e">
<span class="eqno">(17)<a class="headerlink" href="#equation-e" title="Permalink to this equation">#</a></span>\[\boldsymbol{e} = \psi_\mathrm{f} + L_\mathrm{d} \mathrm{Re}\{ \boldsymbol{i}_\mathrm{s}\} + \mathrm{j} L_\mathrm{q} \mathrm{Im}\{\boldsymbol{i}_\mathrm{s} \} - \hat{\boldsymbol{\psi}}_\mathrm{s}\]</div>
<p>where <span class="math notranslate nohighlight">\(\hat{\boldsymbol{\psi}}_\mathrm{s}\)</span> is the stator flux estimate. The flux linkage is estimated by</p>
<div class="math notranslate nohighlight" id="equation-sm-flux-observer">
<span class="eqno">(18)<a class="headerlink" href="#equation-sm-flux-observer" title="Permalink to this equation">#</a></span>\[\frac{\mathrm{d} \hat{\boldsymbol{\psi}}_\mathrm{s}}{\mathrm{d} t} = \boldsymbol{u}_\mathrm{s} - R_\mathrm{s}\boldsymbol{i}_\mathrm{s} - \mathrm{j}\omega_\mathrm{s}\hat{\boldsymbol{\psi}}_\mathrm{s} + \boldsymbol{k}_1 \boldsymbol{e} + \boldsymbol{k}_2 \boldsymbol{e}^*\]</div>
<p>where <span class="math notranslate nohighlight">\(\boldsymbol{k}_1\)</span> and <span class="math notranslate nohighlight">\(\boldsymbol{k}_2\)</span> are gains (complex in a general case), the estimates are marked with the hat, and <span class="math notranslate nohighlight">\(^*\)</span> marks the complex conjugate.</p>
<p>In the sensored mode, <span class="math notranslate nohighlight">\(\omega_\mathrm{s} = \omega_\mathrm{m}\)</span> is used. In the sensorless mode, the speed-adaptive structure (which would correspond to the phase-locked loop if the observer were implemented in stator coordinates) can be used to estimate the rotor angle and speed, respectively, as</p>
<div class="math notranslate nohighlight" id="equation-sm-speed-pos-observer">
<span class="eqno">(19)<a class="headerlink" href="#equation-sm-speed-pos-observer" title="Permalink to this equation">#</a></span>\[\begin{split}\frac{\mathrm{d} \hat{\omega}_\mathrm{m}}{\mathrm{d} t} &amp;= \mathrm{Im}\{\boldsymbol{k}_\mathrm{i} \boldsymbol{e}\} \\
\frac{\mathrm{d}\hat{\vartheta}_\mathrm{m}}{\mathrm{d} t} &amp;= \hat{\omega}_\mathrm{m} + \mathrm{Im}\{\boldsymbol{k}_\mathrm{p} \boldsymbol{e}\} = \omega_\mathrm{s}\end{split}\]</div>
<p>where <span class="math notranslate nohighlight">\(\boldsymbol{k}_\mathrm{i}\)</span> and <span class="math notranslate nohighlight">\(\boldsymbol{k}_\mathrm{p}\)</span> are complex gains. This observer structure is used in the <a class="reference internal" href="../autoapi/motulator/drive/control/sm/index.html#motulator.drive.control.sm.Observer" title="motulator.drive.control.sm.Observer"><code class="xref py py-class docutils literal notranslate"><span class="pre">motulator.drive.control.sm.Observer</span></code></a> class.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Real-valued column vectors and the corresponding <span class="math notranslate nohighlight">\(2\times 2\)</span> gain matrix were used in <a class="footnote-reference brackets" href="#hin2018" id="id14" role="doc-noteref"><span class="fn-bracket">[</span>6<span class="fn-bracket">]</span></a>. The complex form in <a class="reference internal" href="#equation-sm-flux-observer">(18)</a> has the same degrees of freedom.</p>
</div>
</section>
<section id="id15">
<h3>Gain Selection<a class="headerlink" href="#id15" title="Permalink to this heading">#</a></h3>
<section id="id16">
<h4>Sensored Case<a class="headerlink" href="#id16" title="Permalink to this heading">#</a></h4>
<p>In the sensored case, the gain <span class="math notranslate nohighlight">\(\boldsymbol{k}_2=0\)</span> can be set in <a class="reference internal" href="#equation-sm-flux-observer">(18)</a>. Furthermore, <span class="math notranslate nohighlight">\(\delta=0\)</span> holds. Therefore, using <a class="reference internal" href="#equation-sm">(15)</a> and <a class="reference internal" href="#equation-sm-flux-observer">(18)</a>, the linearized estimation error dynamics become</p>
<div class="math notranslate nohighlight" id="equation-dtildepsis-sensored">
<span class="eqno">(20)<a class="headerlink" href="#equation-dtildepsis-sensored" title="Permalink to this equation">#</a></span>\[\frac{\mathrm{d} \Delta\tilde{\boldsymbol{\psi}}_\mathrm{s}}{\mathrm{d} t} = -(\boldsymbol{k}_1 + \mathrm{j}\omega_\mathrm{m0})\Delta\tilde{\boldsymbol{\psi}}_\mathrm{s}\]</div>
<p>where <span class="math notranslate nohighlight">\(\tilde{\boldsymbol{\psi}}_\mathrm{s} = \boldsymbol{\psi}_\mathrm{s} - \hat{\boldsymbol{\psi}}_\mathrm{s}\)</span> is the estimation error, <span class="math notranslate nohighlight">\(\Delta\)</span> marks the small-signal quantities, and the subscript 0 marks the operating-point quantities. It can be seen that the pole can be arbitrarily placed via the gain <span class="math notranslate nohighlight">\(\boldsymbol{k}_1\)</span>. Well-damped estimation-error dynamics can be obtained simply by using a real gain, <span class="math notranslate nohighlight">\(\boldsymbol{k}_1 = \sigma\)</span>, resulting in the pole at <span class="math notranslate nohighlight">\(s = -\sigma - \mathrm{j}\omega_\mathrm{m0}\)</span>, where <span class="math notranslate nohighlight">\(\sigma = 2\pi \cdot 15\)</span> rad/s is used as the default value in <a class="reference internal" href="../autoapi/motulator/drive/control/sm/index.html#motulator.drive.control.sm.Observer" title="motulator.drive.control.sm.Observer"><code class="xref py py-class docutils literal notranslate"><span class="pre">motulator.drive.control.sm.Observer</span></code></a>.</p>
</section>
<section id="id17">
<h4>Sensorless Case<a class="headerlink" href="#id17" title="Permalink to this heading">#</a></h4>
<p>The analysis of the sensorless case is more complicated. Here, the main results are summarized using the complex notation. The following results can be derived from the linearized form of <a class="reference internal" href="#equation-sm">(15)</a> – <a class="reference internal" href="#equation-sm-speed-pos-observer">(19)</a>, see further details in <a class="footnote-reference brackets" href="#hin2018" id="id18" role="doc-noteref"><span class="fn-bracket">[</span>6<span class="fn-bracket">]</span></a></p>
<p>To decouple the flux estimation from the rotor angle, the gains of <a class="reference internal" href="#equation-sm-flux-observer">(18)</a> have to be of the form</p>
<div class="math notranslate nohighlight" id="equation-k1k2-sensorless">
<span class="eqno">(21)<a class="headerlink" href="#equation-k1k2-sensorless" title="Permalink to this equation">#</a></span>\[\boldsymbol{k}_1 = \sigma \qquad \boldsymbol{k}_2 = \frac{\sigma\hat{\boldsymbol{\psi}}_\mathrm{a}}{\hat{\boldsymbol{\psi}}_\mathrm{a}^*}\]</div>
<p>where <span class="math notranslate nohighlight">\(\sigma\)</span> is the desired decay rate of the flux estimation error and</p>
<div class="math notranslate nohighlight" id="equation-sm-aux-flux">
<span class="eqno">(22)<a class="headerlink" href="#equation-sm-aux-flux" title="Permalink to this equation">#</a></span>\[\hat{\boldsymbol{\psi}}_\mathrm{a} = \psi_\mathrm{f} + (L_\mathrm{d} - L_\mathrm{q}) \boldsymbol{i}_\mathrm{s}^*\]</div>
<p>allows to decouple the flux-estimation error dynamics from the rotor-position dynamics. By default, the decay rate is scheduled as</p>
<div class="math notranslate nohighlight" id="equation-sigma-sensorless">
<span class="eqno">(23)<a class="headerlink" href="#equation-sigma-sensorless" title="Permalink to this equation">#</a></span>\[\sigma = \frac{R_\mathrm{s}}{4}\left(\frac{1}{L_\mathrm{d}} + \frac{1}{L_\mathrm{q}}\right) + \zeta_\infty |\hat{\omega}_\mathrm{m} |\]</div>
<p>where <span class="math notranslate nohighlight">\(\zeta_\infty\)</span> is the desired damping ratio at high speed. At zero speed, <a class="reference internal" href="#equation-sigma-sensorless">(23)</a> places one pole at <span class="math notranslate nohighlight">\(s = 0\)</span> and another at <span class="math notranslate nohighlight">\(s = -(R_\mathrm{s}/2)(1/L_\mathrm{d} + 1/L_\mathrm{q})\)</span>.</p>
<p>The gains of the speed adaptation in <a class="reference internal" href="#equation-sm-speed-pos-observer">(19)</a> are selected as</p>
<div class="math notranslate nohighlight" id="equation-ki-kp-sensorless">
<span class="eqno">(24)<a class="headerlink" href="#equation-ki-kp-sensorless" title="Permalink to this equation">#</a></span>\[\boldsymbol{k}_\mathrm{i} = -\frac{\alpha_\mathrm{o}^2}{\hat{\boldsymbol{\psi}}_\mathrm{a}} \qquad \boldsymbol{k}_\mathrm{p} = -\frac{2\alpha_\mathrm{o}}{\hat{\boldsymbol{\psi}}_\mathrm{a}}\]</div>
<p>where <span class="math notranslate nohighlight">\(\alpha_\mathrm{o}\)</span> is the desired speed-estimation bandwidth. The choices <a class="reference internal" href="#equation-k1k2-sensorless">(21)</a> and <a class="reference internal" href="#equation-ki-kp-sensorless">(24)</a> result in the observer characteristic polynomial <span class="math notranslate nohighlight">\(D(s) = (s^2 + 2\sigma s + \omega_\mathrm{m0}^2)(s + \alpha_\mathrm{o})^2\)</span>. Furthermore, it can also be shown that the resulting speed-estimation error dynamics are</p>
<div class="math notranslate nohighlight" id="equation-speed-est-dyn">
<span class="eqno">(25)<a class="headerlink" href="#equation-speed-est-dyn" title="Permalink to this equation">#</a></span>\[\frac{\Delta \hat{\omega}_\mathrm{m}(s)}{\Delta \omega_\mathrm{m}(s)} = \frac{\alpha_\mathrm{o}^2}{(s + \alpha_\mathrm{o})^2}\]</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The flux linkage <span class="math notranslate nohighlight">\(\boldsymbol{\psi}_\mathrm{a}\)</span> is called the auxiliary flux linkage in <a class="footnote-reference brackets" href="#hin2018" id="id19" role="doc-noteref"><span class="fn-bracket">[</span>6<span class="fn-bracket">]</span></a>. It is also linked to the maximum-torque-per-ampere (MTPA) condition, which can be compactly expressed as <span class="math notranslate nohighlight">\(\mathrm{Re}\{\boldsymbol{i}_\mathrm{s}\boldsymbol{\psi}_\mathrm{a}^*\}=0\)</span> <a class="footnote-reference brackets" href="#var2021" id="id20" role="doc-noteref"><span class="fn-bracket">[</span>7<span class="fn-bracket">]</span></a>.</p>
</div>
<p class="rubric">References</p>
<aside class="footnote-list brackets">
<aside class="footnote brackets" id="jon1989" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id9">4</a><span class="fn-bracket">]</span></span>
<p>Jones, Lang, “A state observer for the permanent-magnet synchronous motor,” IEEE Trans. Ind. Electron., 1989, <a class="reference external" href="https://doi.org/10.1109/41.31500">https://doi.org/10.1109/41.31500</a></p>
</aside>
<aside class="footnote brackets" id="cap2001" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id10">5</a><span class="fn-bracket">]</span></span>
<p>Capecchi, Guglielmo, Pastorelli, Vagati, “Position-sensorless control of the transverse-laminated synchronous reluctance motor,” IEEE Trans. Ind. Appl., 2001, <a class="reference external" href="https://doi.org/10.1109/28.968190">https://doi.org/10.1109/28.968190</a></p>
</aside>
<aside class="footnote brackets" id="hin2018" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span>6<span class="fn-bracket">]</span></span>
<span class="backrefs">(<a role="doc-backlink" href="#id11">1</a>,<a role="doc-backlink" href="#id12">2</a>,<a role="doc-backlink" href="#id14">3</a>,<a role="doc-backlink" href="#id18">4</a>,<a role="doc-backlink" href="#id19">5</a>)</span>
<p>Hinkkanen, Saarakkala, Awan, Mölsä, Tuovinen, “Observers for sensorless synchronous motor drives: Framework for design and analysis,” IEEE Trans. Ind. Appl., 2018, <a class="reference external" href="https://doi.org/10.1109/TIA.2018.2858753">https://doi.org/10.1109/TIA.2018.2858753</a></p>
</aside>
<aside class="footnote brackets" id="var2021" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id20">7</a><span class="fn-bracket">]</span></span>
<p>Varatharajan, Pellegrino, Armando, “Direct flux vector control of synchronous motor drives: A small-signal model for optimal reference generation,” IEEE Trans. Power Electron., 2021, <a class="reference external" href="https://doi.org/10.1109/TPEL.2021.3067694">https://doi.org/10.1109/TPEL.2021.3067694</a></p>
</aside>
</aside>
</section>
</section>
</section>
</section>


                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="current_ctrl.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Current Control</p>
      </div>
    </a>
    <a class="right-next"
       href="../auto_examples/index.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Examples</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#induction-machines">Induction Machines</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#machine-model">Machine Model</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#observer-structure">Observer Structure</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#general-coordinates">General Coordinates</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#estimated-flux-coordinates">Estimated Flux Coordinates</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#gain-selection">Gain Selection</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#sensored-case">Sensored Case</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#sensorless-case">Sensorless Case</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#synchronous-machines">Synchronous Machines</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#machine-model-in-general-coordinates">Machine Model in General Coordinates</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id13">Observer Structure</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id15">Gain Selection</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id16">Sensored Case</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id17">Sensorless Case</a></li>
</ul>
</li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Aalto Electric Drives
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2024, Aalto Electric Drives.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=5b4479735964841361fd"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=5b4479735964841361fd"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>